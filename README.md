# WireGuard VPN —Å–µ—Ä–≤–µ—Ä –≤ Yandex Cloud

–≠—Ç–æ—Ç Terraform –ø—Ä–æ–µ–∫—Ç —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É WireGuard VPN —Å–µ—Ä–≤–µ—Ä –≤ Yandex Cloud —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º wg-easy –∏ Docker Compose.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **WireGuard VPN —Å–µ—Ä–≤–µ—Ä** —á–µ—Ä–µ–∑ wg-easy —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** —Å –ø–æ–º–æ—â—å—é cloud-init
- **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** —Å –≥—Ä—É–ø–ø–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–ü—É–±–ª–∏—á–Ω—ã–π IP** –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ VPN
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ QR-–∫–æ–¥–æ–≤

## ‚úÖ –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

- ‚úÖ –í—Å–µ Terraform —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –ü—Ä–æ–≤–∞–π–¥–µ—Ä Yandex Cloud –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ç–∏ (VPC, –ø–æ–¥—Å–µ—Ç—å)
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã —Å security groups
- ‚úÖ Cloud-init —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Docker –∏ wg-easy
- ‚úÖ –°–∫—Ä–∏–ø—Ç `setup-tfvars.sh` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è `terraform.tfvars`
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è YC_TOKEN, YC_CLOUD_ID, YC_FOLDER_ID –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Terraform** >= 0.13
   ```bash
   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Terraform (macOS)
   brew install terraform
   
   # –ò–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ —Å https://www.terraform.io/downloads
   ```

2. **Yandex Cloud CLI (yc)**
   ```bash
   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ yc CLI (macOS)
   curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash
   
   # –ò–ª–∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º: https://cloud.yandex.ru/docs/cli/quickstart
   ```

3. **–ê–∫–∫–∞—É–Ω—Ç Yandex Cloud** —Å:
   - –ê–∫—Ç–∏–≤–Ω—ã–º –æ–±–ª–∞–∫–æ–º
   - –°–æ–∑–¥–∞–Ω–Ω–æ–π –ø–∞–ø–∫–æ–π (folder)
   - –°–µ—Ä–≤–∏—Å–Ω—ã–º –∞–∫–∫–∞—É–Ω—Ç–æ–º —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ compute (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–∫–∫–∞—É–Ω—Ç)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ Yandex Cloud

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è yc CLI
yc init

# –ò–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å OAuth —Ç–æ–∫–µ–Ω–æ–º
yc config set token <–≤–∞—à-—Ç–æ–∫–µ–Ω>
```

**‚úÖ –ì–æ—Ç–æ–≤–æ**: –í—ã —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
export YC_TOKEN=$(yc iam create-token)
export YC_CLOUD_ID=$(yc config get cloud-id)
export YC_FOLDER_ID=$(yc config get folder-id)
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ Cloud ID –∏ Folder ID

–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —à–∞–≥.

```bash
# –°–ø–∏—Å–æ–∫ –æ–±–ª–∞–∫–æ–≤
yc resource-manager cloud list

# –°–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫ –≤ –æ–±–ª–∞–∫–µ
yc resource-manager folder list --cloud-id <cloud-id>
```

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏ Yandex Cloud:
- **Cloud ID**: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–ª–∞–∫–∞ ‚Üí –û–±–∑–æ—Ä
- **Folder ID**: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–ø–∫–∏ ‚Üí –û–±–∑–æ—Ä

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ IP

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø—É–±–ª–∏—á–Ω—ã–π IP
curl -4 ifconfig.me

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å, –Ω–∞–ø—Ä–∏–º–µ—Ä https://ifconfig.me
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Terraform

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–æ—Å–æ–±** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≥–¥–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ YC_CLOUD_ID –∏ YC_FOLDER_ID
./setup-tfvars.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `YC_CLOUD_ID` –∏ `YC_FOLDER_ID` –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü–æ–ª—É—á–∞–µ—Ç –≤–∞—à —Ç–µ–∫—É—â–∏–π IP –∞–¥—Ä–µ—Å
- –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª `terraform.tfvars` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

**–†—É—á–Ω–æ–π —Å–ø–æ—Å–æ–±**:

```bash
# –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞
cp terraform.tfvars.example terraform.tfvars

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º terraform.tfvars —Å–æ —Å–≤–æ–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
nano terraform.tfvars
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```hcl
cloud_id  = "b1gxxxxxxxxxxxxx"
folder_id = "b1gxxxxxxxxxxxxx"
my_ip     = "1.2.3.4/32"  # –í–∞—à –ø—É–±–ª–∏—á–Ω—ã–π IP –≤ CIDR –Ω–æ—Ç–∞—Ü–∏–∏

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ wg-easy
# wg_easy_password = "–≤–∞—à-–±–µ–∑–æ–ø–∞—Å–Ω—ã–π-–ø–∞—Ä–æ–ª—å"
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è**:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/32` –¥–ª—è –æ–¥–Ω–æ–≥–æ IP –∞–¥—Ä–µ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1.2.3.4/32`)
- –ü–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `changeme123` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–∏—Ç—å –≤ `terraform.tfvars`)

### 4.1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

–î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–∫—Ä—ã—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è VPN –∫–ª–∏–µ–Ω—Ç–æ–≤.

**–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `enable_wg_ui`**:
- `true` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 51821
- `false` - –ø–æ—Ä—Ç 51821 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç, –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π workflow**:

1. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º:**
   ```hcl
   enable_wg_ui = true
   ```
   ```bash
   terraform apply
   ```

2. **–°–æ–∑–¥–∞–Ω–∏–µ VPN –∫–ª–∏–µ–Ω—Ç–æ–≤:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ URL –∏–∑ `terraform output`
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
   - –°–∫–∞—á–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–ª–∏ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥—ã

3. **–ó–∞–∫—Ä—ã—Ç–∏–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
   ```hcl
   enable_wg_ui = false
   ```
   ```bash
   terraform apply
   ```

**–í–∞–∂–Ω–æ**:
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ `enable_wg_ui` –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è VM
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ security group (firewall –ø—Ä–∞–≤–∏–ª–∞)
- SSH (–ø–æ—Ä—Ç 22) –∏ WireGuard VPN (–ø–æ—Ä—Ç 51820) –æ—Å—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
- –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ SSH

**–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:**
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤:
```hcl
enable_wg_ui = true
```
```bash
terraform apply
# –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
# –ó–∞–∫—Ä–æ–π—Ç–µ —Å–Ω–æ–≤–∞: enable_wg_ui = false
```

### 4.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –∏ SSL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è —Å HTTPS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º:

**1. –°–æ–∑–¥–∞–π—Ç–µ DNS –∑–æ–Ω—É –≤ Yandex Cloud** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç):

```bash
# –°–æ–∑–¥–∞—Ç—å –ø—É–±–ª–∏—á–Ω—É—é DNS –∑–æ–Ω—É
yc dns zone create --name example-com --zone example.com. --public-visibility

# –ü–æ–ª—É—á–∏—Ç—å ID –∑–æ–Ω—ã
yc dns zone list
```

**2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∑–∞–ø–∏—Å–∏ —É –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–º–µ–Ω–∞:**

–î–æ–±–∞–≤—å—Ç–µ NS –∑–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—ã–µ Yandex Cloud –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–æ–Ω—ã:
```
ns1.yandexcloud.net
ns2.yandexcloud.net
```

**3. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `terraform.tfvars`:**

```hcl
# DNS –∏ SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
domain_name         = "vpn.example.com"           # –í–∞—à –¥–æ–º–µ–Ω
dns_zone_id         = "dns4abc123def456"         # ID DNS –∑–æ–Ω—ã –∏–∑ Yandex Cloud
email_for_letsencrypt = "admin@example.com"       # Email –¥–ª—è Let's Encrypt
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è**:
- –ï—Å–ª–∏ `domain_name` –Ω–µ —É–∫–∞–∑–∞–Ω, –¥–æ—Å—Ç—É–ø –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ IP –∞–¥—Ä–µ—Å—É (HTTP)
- DNS –∑–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π IP VM
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Let's Encrypt
- –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Terraform

```bash
terraform init
```

–≠—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä Yandex Cloud.

### 6. –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–ª–∞–Ω–∞

```bash
terraform plan
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ:
- VPC —Å–µ—Ç—å –∏ –ø–æ–¥—Å–µ—Ç—å
- –ì—Ä—É–ø–ø–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç–∞–Ω—Å (2 vCPU, 2 GB RAM, Ubuntu 22.04)

### 7. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
terraform apply
```

–í–≤–µ–¥–∏—Ç–µ `yes` –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–π–º–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ 2-3 –º–∏–Ω—É—Ç—ã.

### 8. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `terraform apply` –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```bash
terraform output
```

–í—ã –ø–æ–ª—É—á–∏—Ç–µ:
- `vpn_ip`: –ü—É–±–ª–∏—á–Ω—ã–π IP –∞–¥—Ä–µ—Å VPN —Å–µ—Ä–≤–µ—Ä–∞
- `vpn_ui_url`: URL –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (HTTPS –µ—Å–ª–∏ –¥–æ–º–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏–Ω–∞—á–µ HTTP –ø–æ IP)
- `vpn_ui_url_direct`: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –ø–æ IP (HTTP)
- `domain_name`: –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
- `ssh_command`: –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ VM

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ (–±–µ–∑ –¥–æ–º–µ–Ω–∞):
```
vpn_ip = "51.250.XX.XX"
vpn_ui_url = "http://51.250.XX.XX:51821"
vpn_ui_url_direct = "http://51.250.XX.XX:51821"
domain_name = null
ssh_command = "ssh ubuntu@51.250.XX.XX"
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ (—Å –¥–æ–º–µ–Ω–æ–º –∏ SSL):
```
vpn_ip = "51.250.XX.XX"
vpn_ui_url = "https://vpn.example.com"
vpn_ui_url_direct = "http://51.250.XX.XX:51821"
domain_name = "vpn.example.com"
ssh_command = "ssh ubuntu@51.250.XX.XX"
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ï—Å–ª–∏ –≤—ã –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –¥–æ–º–µ–Ω, SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª—É—á–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 5-10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
ssh ubuntu@<vpn_ip>
tail -f /var/log/ssl-setup.log
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ VPN

### 1. –î–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∫–ª—é—á–µ–Ω:**
```bash
terraform output vpn_ui_url
```

–ï—Å–ª–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è `null`, –∑–Ω–∞—á–∏—Ç `enable_wg_ui = false` –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–∫—Ä—ã—Ç. –û—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ:
```hcl
enable_wg_ui = true
```
```bash
terraform apply
```

**–û—Ç–∫—Ä–æ–π—Ç–µ URL –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
- –° –¥–æ–º–µ–Ω–æ–º: `https://vpn.example.com`
- –ë–µ–∑ –¥–æ–º–µ–Ω–∞: `http://51.250.XX.XX:51821`

**–ü–∞—Ä–æ–ª—å**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `wg_easy_password` –≤ `terraform.tfvars` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `changeme123`)

**‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: 
- –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤ `terraform.tfvars` –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö VPN –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞–∫—Ä–æ–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: `enable_wg_ui = false`

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞

1. –ù–∞–∂–º–∏—Ç–µ **"New Client"** –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
2. –í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è –≤–∞—à–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
3. –ù–∞–∂–º–∏—Ç–µ **"Create"**
4. –°–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–ª–∏ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥

### 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VPN

#### macOS/iOS
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.conf` –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ WireGuard
- –ò–ª–∏ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º WireGuard
- –í–∫–ª—é—á–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

#### Linux
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ WireGuard
sudo apt install wireguard

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é WireGuard
sudo cp client.conf /etc/wireguard/wg0.conf

# –ó–∞–ø—É—Å–∫ VPN
sudo wg-quick up wg0

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ VPN
sudo wg-quick down wg0
```

#### Windows
- –°–∫–∞—á–∞–π—Ç–µ WireGuard –¥–ª—è Windows
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.conf`
- –ù–∞–∂–º–∏—Ç–µ "Activate"

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π IP (–¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å IP VPN —Å–µ—Ä–≤–µ—Ä–∞)
curl -4 ifconfig.me

# –ò–ª–∏ –ø–æ—Å–µ—Ç–∏—Ç–µ https://ifconfig.me
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ providers.tf              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ Terraform
‚îú‚îÄ‚îÄ variables.tf              # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ terraform.tfvars.example  # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ network.tf                # VPC —Å–µ—Ç—å –∏ –ø–æ–¥—Å–µ—Ç—å
‚îú‚îÄ‚îÄ dns.tf                    # DNS –∑–∞–ø–∏—Å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ vm.tf                     # –í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç–∞–Ω—Å –∏ –≥—Ä—É–ø–ø–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ cloud-init.yaml           # Cloud-init —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VM
‚îú‚îÄ‚îÄ outputs.tf                # –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Terraform
‚îú‚îÄ‚îÄ setup-tfvars.sh           # –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è terraform.tfvars
‚îú‚îÄ‚îÄ .gitignore                # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã Git
‚îî‚îÄ‚îÄ README.md                 # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## –î–µ—Ç–∞–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–∞–≤–∏–ª–∞ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- **UDP 51820**: –û—Ç–∫—Ä—ã—Ç –¥–ª—è `0.0.0.0/0` (WireGuard VPN)
- **TCP 22**: –û—Ç–∫—Ä—ã—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è `my_ip` (SSH)
- **TCP 51821**: –û—Ç–∫—Ä—ã—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è `my_ip` (–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É) - **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `enable_wg_ui = true`**
- **TCP 80**: –û—Ç–∫—Ä—ã—Ç –¥–ª—è `0.0.0.0/0` (HTTP, –¥–ª—è Let's Encrypt)
- **TCP 443**: –û—Ç–∫—Ä—ã—Ç –¥–ª—è `0.0.0.0/0` (–µ—Å–ª–∏ –¥–æ–º–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω) –∏–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è `my_ip` (–µ—Å–ª–∏ –¥–æ–º–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- **–í–µ—Å—å –∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫**: –†–∞–∑—Ä–µ—à–µ–Ω

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ü–æ—Ä—Ç 51821 —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `enable_wg_ui`. –ö–æ–≥–¥–∞ `enable_wg_ui = false`, –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –ø–æ—Ä—Ç–∞ 51821 –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è, –∏ –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç.

### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ VM

- **–û–±—Ä–∞–∑**: Ubuntu 22.04 LTS
- **vCPU**: 2 —è–¥—Ä–∞
- **RAM**: 2 GB
- **–î–∏—Å–∫**: 20 GB
- **–ó–æ–Ω–∞**: ru-central1-a

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è wg-easy

- **WG_HOST**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ) –∏–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–π IP VM
- **WG_ALLOWED_IPS**: `0.0.0.0/0` (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ VPN)
- **WG_PORT**: 51820 (UDP)
- **–ü–æ—Ä—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞**: 51821 (TCP, –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ nginx)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: `/opt/wireguard/wg-data`

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx –∏ SSL

- **nginx**: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ reverse proxy –¥–ª—è wg-easy
- **Let's Encrypt**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–µ—Å–ª–∏ –¥–æ–º–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- **HTTPS**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç —Å HTTP –Ω–∞ HTTPS (–µ—Å–ª–∏ –¥–æ–º–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- **–î–æ—Å—Ç—É–ø**: –ß–µ—Ä–µ–∑ –¥–æ–º–µ–Ω (HTTPS) –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –ø–æ IP (HTTP –Ω–∞ –ø–æ—Ä—Ç—É 51821)

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ù–µ –º–æ–≥—É –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∫–ª—é—á–µ–Ω:**
   ```bash
   terraform output vpn_ui_url
   ```
   –ï—Å–ª–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è `null`, –∑–Ω–∞—á–∏—Ç `enable_wg_ui = false`. –í–∫–ª—é—á–∏—Ç–µ –µ–≥–æ:
   ```hcl
   enable_wg_ui = true
   ```
   ```bash
   terraform apply
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∞—à IP –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤ `terraform.tfvars`:
   ```bash
   curl -4 ifconfig.me
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
   ```bash
   terraform show | grep -A 10 security_group
   ```
   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –ø–æ—Ä—Ç–∞ 51821 –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–µ—Å–ª–∏ `enable_wg_ui = true`).

4. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH –∫ VM –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Docker:
   ```bash
   ssh ubuntu@<vpn_ip>
   docker ps
   docker logs wg-easy
   ```

5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ nginx (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–æ–º–µ–Ω):
   ```bash
   ssh ubuntu@<vpn_ip>
   sudo systemctl status nginx
   ```

### VPN –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ WireGuard –∑–∞–ø—É—â–µ–Ω:
   ```bash
   ssh ubuntu@<vpn_ip>
   docker ps | grep wg-easy
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞:
   ```bash
   sudo iptables -L -n
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ WireGuard:
   ```bash
   docker logs wg-easy
   ```

### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ DNS –∑–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞ –∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP:
   ```bash
   dig +short vpn.example.com
   # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ VPN —Å–µ—Ä–≤–µ—Ä–∞
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:
   ```bash
   ssh ubuntu@<vpn_ip>
   tail -f /var/log/ssl-setup.log
   ```

3. –ï—Å–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –ø–æ–ª—É—á–∏—Ç–µ –µ–≥–æ –≤—Ä—É—á–Ω—É—é:
   ```bash
   ssh ubuntu@<vpn_ip>
   sudo certbot certonly --webroot -w /var/www/html -d vpn.example.com
   sudo systemctl reload nginx
   ```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å nginx:
   ```bash
   sudo systemctl status nginx
   sudo nginx -t
   ```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±** (—á–µ—Ä–µ–∑ Terraform):

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `terraform.tfvars`:
   ```hcl
   wg_easy_password = "–≤–∞—à-–Ω–æ–≤—ã–π-–±–µ–∑–æ–ø–∞—Å–Ω—ã–π-–ø–∞—Ä–æ–ª—å"
   ```

2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
   ```bash
   terraform apply
   ```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±** (–≤—Ä—É—á–Ω—É—é –Ω–∞ VM):

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH –∫ VM:
   ```bash
   ssh ubuntu@<vpn_ip>
   ```

2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ docker-compose.yml:
   ```bash
   sudo nano /opt/wireguard/docker-compose.yml
   # –ò–∑–º–µ–Ω–∏—Ç–µ PASSWORD=... –Ω–∞ –≤–∞—à –ø–∞—Ä–æ–ª—å
   ```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   ```bash
   cd /opt/wireguard
   sudo docker compose down
   sudo docker compose up -d
   ```

## –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (—á—Ç–æ–±—ã –Ω–µ –ø–ª–∞—Ç–∏—Ç—å)

–ö–æ–≥–¥–∞ VPN —Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω—É–∂–µ–Ω, —É–¥–∞–ª–∏—Ç–µ –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã, —á—Ç–æ–±—ã –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—ã:

### –ë—ã—Å—Ç—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Terraform

```bash
# 1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ
terraform plan -destroy

# 2. –£–¥–∞–ª–∏—Ç—å –í–°–ï —Ä–µ—Å—É—Ä—Å—ã
terraform destroy
```

–í–≤–µ–¥–∏—Ç–µ `yes` –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ. –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –ø–ª–∞—Ç–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:
- ‚úÖ **VM (–≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞)** - –æ—Å–Ω–æ–≤–Ω–∞—è –ø–ª–∞—Ç–∞ (~$15-20/–º–µ—Å—è—Ü)
- ‚úÖ **–î–∏—Å–∫ VM** - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- ‚úÖ **–ü—É–±–ª–∏—á–Ω—ã–π IP** - –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ **Security Group** - –≥—Ä—É–ø–ø–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ **Subnet** - –ø–æ–¥—Å–µ—Ç—å
- ‚úÖ **VPC Network** - —Å–µ—Ç—å
- ‚úÖ **DNS –∑–∞–ø–∏—Å—å** - –µ—Å–ª–∏ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞

**üí∞ –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—ã –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—Å—è —Å—Ä–∞–∑—É.**

### –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ —É–¥–∞–ª–µ–Ω–æ

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Terraform
terraform show
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ (–∏–ª–∏ —Ç–æ–ª—å–∫–æ data –∏—Å—Ç–æ—á–Ω–∏–∫–∏)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Yandex Cloud CLI
yc compute instance list
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç—ã–º: []

yc vpc network list
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç—ã–º (–∏–ª–∏ —Ç–æ–ª—å–∫–æ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ —Å–µ—Ç–∏)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–ª–ª–∏–Ω–≥–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Yandex Cloud Console](https://console.cloud.yandex.ru)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ë–∏–ª–ª–∏–Ω–≥** ‚Üí **–û—Ç—á–µ—Ç—ã**
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞ Compute Instance –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å
4. –û–±—ã—á–Ω–æ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 5-10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è

### –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ

–ö–æ–≥–¥–∞ VPN —Å–Ω–æ–≤–∞ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è, –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
terraform apply
```

–í—Å–µ —Ä–µ—Å—É—Ä—Å—ã —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∑–∞–Ω–æ–≤–æ —Å —Ç–µ–º–∏ –∂–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

### ‚ö†Ô∏è –í–∞–∂–Ω–æ

- **–£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `terraform destroy`** - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã
- **–ù–µ —É–¥–∞–ª—è–π—Ç–µ —Ç–æ–ª—å–∫–æ `terraform.tfstate`** - —ç—Ç–æ –Ω–µ —É–¥–∞–ª–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –≤ –æ–±–ª–∞–∫–µ, —Ç–æ–ª—å–∫–æ –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–∏—Ö
- **–í—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ VM –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **DNS –∑–∞–ø–∏—Å—å —É–¥–∞–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**, –µ—Å–ª–∏ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ —á–µ—Ä–µ–∑ Terraform

## –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

–ü—Ä–∏–º–µ—Ä–Ω–∞—è –º–µ—Å—è—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ Yandex Cloud:
- **VM (2 vCPU, 2 GB RAM)**: ~$15-20/–º–µ—Å—è—Ü
- **–ü—É–±–ª–∏—á–Ω—ã–π IP**: –û–±—ã—á–Ω–æ –≤–∫–ª—é—á–µ–Ω
- **–¢—Ä–∞—Ñ–∏–∫**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã: https://cloud.yandex.ru/docs/compute/pricing

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: –û–±–Ω–æ–≤–∏—Ç–µ `wg_easy_password` –≤ `terraform.tfvars` –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH –∫–ª—é—á–∏**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ SSH –∫–ª—é—á–∞–º –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É**: –û–±–Ω–æ–≤–ª—è–π—Ç–µ `my_ip`, –µ—Å–ª–∏ –≤–∞—à IP –∏–∑–º–µ–Ω–∏–ª—Å—è
4. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ VM –∏ Docker –æ–±—Ä–∞–∑—ã –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –±–∏–ª–ª–∏–Ω–≥ Yandex Cloud
6. **–•—Ä–∞–Ω–∏—Ç–µ terraform.tfvars –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –µ–≥–æ –≤ Git

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å:
- **Terraform**: –°–º. [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Terraform Yandex Provider](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs)
- **wg-easy**: –°–º. [wg-easy GitHub](https://github.com/wg-easy/wg-easy)
- **WireGuard**: –°–º. [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é WireGuard](https://www.wireguard.com/)

## –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
